<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Your Blueprint - MGRNZ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            width: 100%;
            background: #131c32;
            border-radius: 16px;
            padding: 40px;
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
            text-align: center;
        }
        h1 {
            color: #fff;
            margin-bottom: 1rem;
            font-size: 32px;
        }
        p {
            color: #cbd5e0;
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        input {
            width: 100%;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #2d3748;
            background: #0f172a;
            color: #fff;
            font-size: 16px;
        }
        input:focus {
            outline: none;
            border-color: #ff4f00;
        }
        button {
            width: 100%;
            padding: 1rem;
            background: #ff4f00;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:hover {
            background: #e64500;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .message {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            display: none;
        }
        .message.success {
            background: rgba(74, 222, 128, 0.1);
            color: #4ade80;
            border: 1px solid rgba(74, 222, 128, 0.2);
        }
        .message.error {
            background: rgba(255, 79, 0, 0.1);
            color: #ff4f00;
            border: 1px solid rgba(255, 79, 0, 0.2);
        }
        .debug {
            background: #1e293b;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #334155;
            text-align: left;
        }
        .debug h3 {
            color: #4ade80;
            margin-top: 0;
            font-size: 14px;
        }
        .debug p {
            margin: 5px 0;
            color: #cbd5e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Almost There!</h1>
        <p>Enter your name and email to unlock your personalized AI Workflow Blueprint.</p>

        <div class="debug" id="debug-info"></div>

        <form id="subscribe-form">
            <div class="form-group">
                <input type="text" id="name" placeholder="Your Name" required>
            </div>
            <div class="form-group">
                <input type="email" id="email" placeholder="Your Email Address" required>
            </div>
            <button type="submit" id="submit-btn">Unlock & Download Blueprint</button>
        </form>

        <div id="message" class="message"></div>
    </div>

    <script>
    console.log('=== STANDALONE QUOTE PAGE LOADED ===');
    
    // Get data from localStorage
    const wizardData = JSON.parse(localStorage.getItem('mgrnz_wizard_data') || '{}');
    const blueprintHTML = localStorage.getItem('mgrnz_blueprint_download');
    
    console.log('Data check:', {
        hasWizardData: !!wizardData,
        hasBlueprintHTML: !!blueprintHTML,
        blueprintLength: blueprintHTML ? blueprintHTML.length : 0
    });
    
    // Show debug info
    const debugInfo = document.getElementById('debug-info');
    debugInfo.innerHTML = `
        <h3>ðŸ“Š Debug Info</h3>
        <p><strong>Has wizard data:</strong> <span style="color: ${!!wizardData ? '#4ade80' : '#ff4f00'}">${!!wizardData ? 'YES' : 'NO'}</span></p>
        <p><strong>Has blueprint HTML:</strong> <span style="color: ${!!blueprintHTML ? '#4ade80' : '#ff4f00'}">${!!blueprintHTML ? 'YES' : 'NO'}</span></p>
        <p><strong>Blueprint length:</strong> ${blueprintHTML ? blueprintHTML.length : 0} characters</p>
        ${wizardData.submission_ref ? `<p><strong>Session:</strong> ${wizardData.submission_ref}</p>` : ''}
    `;
    
    if (!blueprintHTML) {
        document.getElementById('message').style.display = 'block';
        document.getElementById('message').className = 'message error';
        document.getElementById('message').textContent = 'No blueprint data found. Please go back and generate your blueprint first.';
        document.getElementById('submit-btn').disabled = true;
    }
    
    // Handle form submission
    document.getElementById('subscribe-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const submitBtn = document.getElementById('submit-btn');
        const message = document.getElementById('message');
        
        if (!name || !email) {
            message.style.display = 'block';
            message.className = 'message error';
            message.textContent = 'Please fill in all fields.';
            return;
        }
        
        submitBtn.disabled = true;
        submitBtn.textContent = 'Processing...';
        message.style.display = 'none';
        
        console.log('Submitting to API...');
        
        try {
            const response = await fetch(window.location.origin + '/wp-json/mgrnz/v1/subscribe-blueprint', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    session_id: wizardData.submission_ref || 'direct_' + Date.now(),
                    name: name,
                    email: email,
                    blueprint_data: {
                        html: blueprintHTML,
                        content: blueprintHTML
                    }
                })
            });
            
            const data = await response.json();
            console.log('API Response:', data);
            
            if (data.success && data.download_url) {
                message.style.display = 'block';
                message.className = 'message success';
                message.textContent = 'Success! Opening your blueprint...';
                
                // Open the blueprint
                setTimeout(function() {
                    window.location.href = data.download_url;
                }, 1000);
            } else {
                throw new Error(data.message || 'Download failed');
            }
        } catch (error) {
            console.error('Error:', error);
            message.style.display = 'block';
            message.className = 'message error';
            message.textContent = 'Error: ' + error.message;
            submitBtn.disabled = false;
            submitBtn.textContent = 'Unlock & Download Blueprint';
        }
    });
    </script>
</body>
</html>

