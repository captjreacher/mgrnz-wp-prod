<style>
  .mgrnz-ai-wizard {
    max-width: 840px;
    margin: 2rem auto 4rem;
    padding: 2rem 2.5rem;
    background: #0f172a;
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: 0 18px 60px rgba(0, 0, 0, 0.5);
    color: #ffffff;
    font-family: inherit;
  }
  .mgrnz-ai-wizard h2 {
    font-size: 1.8rem;
    margin: 0 0 0.75rem;
    color: #ffffff;
  }
  .mgrnz-ai-wizard p {
    margin: 0 0 1.25rem;
    color: rgba(255, 255, 255, 0.8);
  }
  .mgrnz-ai-progress {
    margin-bottom: 1.5rem;
  }
  .mgrnz-ai-progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.4rem;
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.7);
  }
  .mgrnz-ai-step-label {
    font-weight: 600;
  }
  .mgrnz-ai-progress-bar {
    position: relative;
    width: 100%;
    height: 6px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.12);
    overflow: hidden;
  }
  .mgrnz-ai-progress-fill {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 20%;
    background: linear-gradient(90deg, #ffcf00, #ff4f00);
    transition: width 0.25s ease;
  }
  .mgrnz-ai-step-title {
    font-size: 1.2rem;
    margin-bottom: 0.6rem;
    color: #ffffff;
  }
  .mgrnz-field {
    margin-bottom: 1.5rem;
  }
  .mgrnz-field label {
    display: block;
    font-size: 0.95rem;
    font-weight: 500;
    margin-bottom: 0.35rem;
    color: rgba(255, 255, 255, 0.9);
  }
  .mgrnz-field textarea,
  .mgrnz-field input[type="text"],
  .mgrnz-field input[type="email"] {
    width: 100%;
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.18);
    background: #131c32;
    color: #ffffff;
    padding: 0.75rem 0.9rem;
    font-size: 0.95rem;
    resize: vertical;
  }
  .mgrnz-field textarea::placeholder,
  .mgrnz-field input::placeholder {
    color: rgba(255, 255, 255, 0.45);
  }
  .mgrnz-ai-nav {
    display: flex;
    justify-content: space-between;
    gap: 1rem;
    margin-top: 0.25rem;
  }
  .mgrnz-ai-nav .spacer {
    flex: 1;
  }
  .mgrnz-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 999px;
    padding: 0.7rem 1.4rem;
    font-size: 0.95rem;
    font-weight: 600;
    text-decoration: none;
    border: 2px solid transparent;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
  }
  .mgrnz-btn-primary {
    background: #0f172a;
    color: #ffffff;
    border-color: #ff4f00;
  }
  .mgrnz-btn-primary:hover {
    background: #ffffff;
    color: #ff4f00;
  }
  .mgrnz-btn-secondary {
    background: transparent;
    color: rgba(255, 255, 255, 0.9);
    border-color: rgba(255, 255, 255, 0.5);
  }
  .mgrnz-btn-secondary:hover {
    background: rgba(255, 255, 255, 0.1);
  }
  .mgrnz-btn[disabled] {
    opacity: 0.65;
    cursor: not-allowed;
  }
  .mgrnz-status {
    margin-top: 0.75rem;
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.8);
    min-height: 1.1em;
  }
  .mgrnz-status-error {
    color: #ffcf00;
  }
  .mgrnz-ai-review-list {
    list-style: none;
    padding: 0;
    margin: 0 0 1rem;
    font-size: 0.9rem;
  }
  .mgrnz-ai-review-list li {
    margin-bottom: 0.5rem;
  }
  .mgrnz-ai-review-label {
    font-weight: 600;
    color: rgba(255, 255, 255, 0.9);
  }
  .mgrnz-ai-steps {
    position: relative;
  }
  .mgrnz-ai-step {
    display: none;
  }
  .mgrnz-ai-step.active {
    display: block;
  }
  .mgrnz-blueprint-wrap h2 {
    font-size: 1.6rem;
    margin-bottom: 0.75rem;
  }
  .mgrnz-summary {
    font-size: 0.98rem;
    margin-bottom: 1.25rem;
  }
  .mgrnz-blueprint {
    padding: 1rem 1.1rem;
    background: #131c32;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.12);
    max-height: 420px;
    overflow: auto;
    font-size: 0.9rem;
  }
  .mgrnz-blueprint pre {
    margin: 0;
    white-space: pre-wrap;
    word-wrap: break-word;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
      "Liberation Mono", "Courier New", monospace;
  }
  .mgrnz-ai-actions {
    margin-top: 1.5rem;
  }
  .mgrnz-ai-actions-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  /* Progress Animation */
  #assistant-progress {
    display: none;
    padding: 2rem;
    text-align: center;
  }
  #assistant-progress.show {
    display: block;
  }
  .progress-message {
    font-size: 1.1rem;
    margin: 1rem 0;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .progress-message.active {
    opacity: 1;
  }

  /* Completion Screen */
  #completion-screen {
    display: none;
    padding: 2rem;
    text-align: center;
  }
  #completion-screen.show {
    display: block;
  }
  .completion-action-btn {
    display: block;
    width: 100%;
    padding: 1rem;
    margin: 0.75rem 0;
    background: #131c32;
    border: 1px solid rgba(255, 255, 255, 0.18);
    border-radius: 12px;
    color: #ffffff;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 1rem;
  }
  .completion-action-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateY(-2px);
  }
  .btn-icon {
    font-size: 1.5rem;
    display: block;
    margin-bottom: 0.5rem;
  }

  /* Modals */
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10000;
    align-items: center;
    justify-content: center;
  }
  .modal-overlay.show {
    display: flex;
  }
  .modal-content {
    background: #0f172a;
    border-radius: 16px;
    padding: 2rem;
    max-width: 500px;
    width: 90%;
    border: 1px solid rgba(255, 255, 255, 0.08);
    position: relative;
  }
  .modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.6);
    font-size: 1.5rem;
    cursor: pointer;
    line-height: 1;
    padding: 0.25rem;
  }
  .modal-close:hover {
    color: #ffffff;
  }
  .modal-content h3 {
    margin-top: 0;
    color: #ffffff;
  }
  .modal-content .form-group {
    margin-bottom: 1rem;
  }
  .modal-content input,
  .modal-content textarea {
    width: 100%;
    padding: 0.75rem;
    background: #131c32;
    border: 1px solid rgba(255, 255, 255, 0.18);
    border-radius: 8px;
    color: #ffffff;
    font-size: 0.95rem;
  }
  .modal-content button[type="submit"],
  .btn-submit {
    width: 100%;
    padding: 0.75rem;
    background: #ff4f00;
    border: none;
    border-radius: 999px;
    color: #ffffff;
    font-weight: 600;
    cursor: pointer;
    margin-top: 0.5rem;
  }
  .modal-content button[type="submit"]:hover,
  .btn-submit:hover {
    background: #ff6a1a;
  }

  /* Popup */
  .popup-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10000;
    align-items: center;
    justify-content: center;
  }
  .popup-overlay.show {
    display: flex;
  }
  .popup-content {
    background: #0f172a;
    border-radius: 16px;
    padding: 2rem;
    max-width: 400px;
    width: 90%;
    text-align: center;
  }
  .popup-buttons {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
  }
  .popup-btn {
    flex: 1;
    padding: 0.75rem;
    border-radius: 999px;
    border: 2px solid;
    cursor: pointer;
    font-weight: 600;
  }
  .popup-btn-primary {
    background: #ff4f00;
    border-color: #ff4f00;
    color: #ffffff;
  }
  .popup-btn-secondary {
    background: transparent;
    border-color: rgba(255, 255, 255, 0.5);
    color: rgba(255, 255, 255, 0.9);
  }

  @media (max-width: 720px) {
    .mgrnz-ai-wizard {
      margin: 1.5rem 1rem 3rem;
      padding: 1.5rem 1.25rem;
    }
    .mgrnz-ai-actions-buttons {
      flex-direction: column;
    }
    .mgrnz-btn {
      width: 100%;
      justify-content: center;
    }
  }
</style>

<section class="mgrnz-ai-wizard">
  <div id="ai-wizard-form-wrap">
    <h2>Start using AI in your workflow</h2>
    <p>Tell me what you're trying to achieve and how you work today. I'll map out a practical AI-enabled workflow for you.</p>

    <div class="mgrnz-ai-progress">
      <div class="mgrnz-ai-progress-header">
        <span class="mgrnz-ai-step-label" id="ai-step-label">Step 1 of 5</span>
        <span id="ai-step-caption">Your goal</span>
      </div>
      <div class="mgrnz-ai-progress-bar">
        <div class="mgrnz-ai-progress-fill" id="ai-progress-fill"></div>
      </div>
    </div>

    <form id="ai-wizard-form" novalidate>
      <div class="mgrnz-ai-steps">
        <!-- STEP 1 -->
        <div class="mgrnz-ai-step active" data-step="1">
          <div class="mgrnz-ai-step-title">What's the main outcome you want?</div>
          <div class="mgrnz-field">
            <label for="goal">Describe your ideal result.</label>
            <textarea
              id="goal"
              name="goal"
              rows="3"
              placeholder="e.g. Consistently generate and qualify leads without me living in my inbox."
            ></textarea>
          </div>
        </div>

        <!-- STEP 2 -->
        <div class="mgrnz-ai-step" data-step="2">
          <div class="mgrnz-ai-step-title">How do you currently do this?</div>
          <div class="mgrnz-field">
            <label for="workflow">
              Walk me through your current workflow step-by-step.
            </label>
            <textarea
              id="workflow"
              name="workflow_description"
              rows="4"
              placeholder="Include who does what, and in what order."
            ></textarea>
          </div>
        </div>

        <!-- STEP 3 -->
        <div class="mgrnz-ai-step" data-step="3">
          <div class="mgrnz-ai-step-title">Select any software your business uses</div>
          <div class="mgrnz-field">
            <label>Choose all that apply (or select "Not sure" if you don't know):</label>
            
            <div style="margin-top: 1rem;">
              <div style="margin-bottom: 1.5rem;">
                <div style="font-weight: 600; color: #ffcf00; margin-bottom: 0.5rem;">Email & CRM</div>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.5rem;">
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Salesforce" style="margin-right: 0.5rem;">
                    <span>Salesforce</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="HubSpot" style="margin-right: 0.5rem;">
                    <span>HubSpot</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Gmail" style="margin-right: 0.5rem;">
                    <span>Gmail</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Outlook" style="margin-right: 0.5rem;">
                    <span>Outlook</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="MailerLite" style="margin-right: 0.5rem;">
                    <span>MailerLite</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Mailchimp" style="margin-right: 0.5rem;">
                    <span>Mailchimp</span>
                  </label>
                </div>
              </div>

              <div style="margin-bottom: 1.5rem;">
                <div style="font-weight: 600; color: #ffcf00; margin-bottom: 0.5rem;">Spreadsheets & Data</div>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.5rem;">
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Google Sheets" style="margin-right: 0.5rem;">
                    <span>Google Sheets</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Microsoft Excel" style="margin-right: 0.5rem;">
                    <span>Microsoft Excel</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Airtable" style="margin-right: 0.5rem;">
                    <span>Airtable</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Notion" style="margin-right: 0.5rem;">
                    <span>Notion</span>
                  </label>
                </div>
              </div>

              <div style="margin-bottom: 1.5rem;">
                <div style="font-weight: 600; color: #ffcf00; margin-bottom: 0.5rem;">Automation Platforms</div>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.5rem;">
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Make.com" style="margin-right: 0.5rem;">
                    <span>Make.com</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Zapier" style="margin-right: 0.5rem;">
                    <span>Zapier</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="n8n" style="margin-right: 0.5rem;">
                    <span>n8n</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Power Automate" style="margin-right: 0.5rem;">
                    <span>Power Automate</span>
                  </label>
                </div>
              </div>

              <div style="margin-bottom: 1.5rem;">
                <div style="font-weight: 600; color: #ffcf00; margin-bottom: 0.5rem;">AI & ML Platforms</div>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.5rem;">
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="OpenAI (ChatGPT)" style="margin-right: 0.5rem;">
                    <span>OpenAI (ChatGPT)</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Anthropic (Claude)" style="margin-right: 0.5rem;">
                    <span>Anthropic (Claude)</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Google AI" style="margin-right: 0.5rem;">
                    <span>Google AI</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Hugging Face" style="margin-right: 0.5rem;">
                    <span>Hugging Face</span>
                  </label>
                </div>
              </div>

              <div style="margin-bottom: 1.5rem;">
                <div style="font-weight: 600; color: #ffcf00; margin-bottom: 0.5rem;">Development & Collaboration</div>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.5rem;">
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="GitHub" style="margin-right: 0.5rem;">
                    <span>GitHub</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="GitLab" style="margin-right: 0.5rem;">
                    <span>GitLab</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Jira" style="margin-right: 0.5rem;">
                    <span>Jira</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Slack" style="margin-right: 0.5rem;">
                    <span>Slack</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Microsoft Teams" style="margin-right: 0.5rem;">
                    <span>Microsoft Teams</span>
                  </label>
                </div>
              </div>

              <div style="margin-bottom: 1.5rem;">
                <div style="font-weight: 600; color: #ffcf00; margin-bottom: 0.5rem;">Content & Web</div>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.5rem;">
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="WordPress" style="margin-right: 0.5rem;">
                    <span>WordPress</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Shopify" style="margin-right: 0.5rem;">
                    <span>Shopify</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Webflow" style="margin-right: 0.5rem;">
                    <span>Webflow</span>
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="tools" value="Canva" style="margin-right: 0.5rem;">
                    <span>Canva</span>
                  </label>
                </div>
              </div>

              <div style="margin-bottom: 0.5rem;">
                <label style="display: flex; align-items: center; cursor: pointer; font-weight: 600;">
                  <input type="checkbox" name="tools" value="N/A - Not sure" style="margin-right: 0.5rem;">
                  <span>Not sure / None of these</span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 4 -->
        <div class="mgrnz-ai-step" data-step="4">
          <div class="mgrnz-ai-step-title">
            Where does it feel slow, manual, or messy?
          </div>
          <div class="mgrnz-field">
            <label for="pain_points">
              What drains your time, energy, or accuracy?
            </label>
            <textarea
              id="pain_points"
              name="pain_points"
              rows="3"
              placeholder="e.g. Copying data between tools, chasing people, keeping track of follow-ups."
            ></textarea>
          </div>
        </div>

        <!-- STEP 5 -->
        <div class="mgrnz-ai-step" data-step="5">
          <div class="mgrnz-ai-step-title">Where can I send follow-ups?</div>
          <div class="mgrnz-field">
            <label for="email">
              Email (optional, but handy if you want me to refine this with you)
            </label>
            <input
              id="email"
              name="email"
              type="email"
              placeholder="you@example.com"
            />
          </div>

          <p style="margin-top: 0.5rem; margin-bottom: 0.75rem;">
            Quick review of what you've told me:
          </p>
          <ul class="mgrnz-ai-review-list">
            <li>
              <span class="mgrnz-ai-review-label">Goal:</span>
              <span id="review-goal"></span>
            </li>
            <li>
              <span class="mgrnz-ai-review-label">Current workflow:</span>
              <span id="review-workflow"></span>
            </li>
            <li>
              <span class="mgrnz-ai-review-label">Tools:</span>
              <span id="review-tools"></span>
            </li>
            <li>
              <span class="mgrnz-ai-review-label">Pain points:</span>
              <span id="review-pain"></span>
            </li>
          </ul>
          <p style="font-size: 0.85rem; color: rgba(255,255,255,0.7);">
            When you click "Build my AI workflow", I'll send these details to my
            AI workflow engine and generate a tailored blueprint for you.
          </p>
        </div>
      </div>

      <div class="mgrnz-ai-nav">
        <button
          type="button"
          class="mgrnz-btn mgrnz-btn-secondary"
          id="ai-prev-btn"
        >
          Back
        </button>
        <div class="spacer"></div>
        <button
          type="button"
          class="mgrnz-btn mgrnz-btn-primary"
          id="ai-next-btn"
        >
          Next
        </button>
        <button
          type="button"
          class="mgrnz-btn mgrnz-btn-primary"
          id="ai-submit-btn"
          style="display: none;"
        >
          Build my AI workflow
        </button>
      </div>

      <div id="ai-wizard-status" class="mgrnz-status" aria-live="polite"></div>
    </form>
  </div>

  <!-- Progress Animation (Hidden Initially) -->
  <div id="assistant-progress" style="display: none;">
    <div class="progress-message" id="progress-msg-1"></div>
    <div class="progress-message" id="progress-msg-2"></div>
    <div class="progress-message" id="progress-msg-3"></div>
  </div>

  <!-- Completion Screen (Hidden Initially) -->
  <div id="completion-screen" style="display: none;">
    <div class="completion-message">
      <h2>What do you want to do next?</h2>
    </div>
    <div class="completion-action-buttons">
      <button id="btn-edit-workflow" class="completion-action-btn">
        <span class="btn-icon">‚úèÔ∏è</span>
        <span class="btn-text">Edit my Workflow</span>
      </button>
      <button id="btn-download-blueprint" class="completion-action-btn">
        <span class="btn-icon">‚¨áÔ∏è</span>
        <span class="btn-text">Download My Blueprint</span>
      </button>
      <button id="btn-get-quote" class="completion-action-btn" onclick="ml('show', '171717223009748040', true)">
        <span class="btn-icon">üí∞</span>
        <span class="btn-text">Get a Quote for this Workflow</span>
      </button>
      <button id="btn-go-back" class="completion-action-btn">
        <span class="btn-icon">‚Ü©Ô∏è</span>
        <span class="btn-text">Go Back</span>
      </button>
    </div>
  </div>

  <!-- Blueprint Display (Hidden Initially) -->
  <div
    id="ai-wizard-blueprint-wrap"
    class="mgrnz-blueprint-wrap"
    style="display: none;"
  >
    <h2>Your AI-enabled workflow blueprint</h2>
    <p id="ai-wizard-summary" class="mgrnz-summary"></p>

    <div id="ai-wizard-blueprint-markdown" class="mgrnz-blueprint"></div>

    <div class="mgrnz-ai-actions">
      <p>What do you want to do next?</p>
      <div class="mgrnz-ai-actions-buttons">
        <button
          type="button"
          class="mgrnz-btn mgrnz-btn-secondary"
          id="ai-wizard-subscribe"
        >
          Subscribe &amp; get updates
        </button>

        <button
          type="button"
          class="mgrnz-btn mgrnz-btn-primary"
          id="ai-wizard-consult"
        >
          Book an AI consult
        </button>
      </div>
    </div>

    <div
      id="ai-wizard-decision-status"
      class="mgrnz-status"
      aria-live="polite"
    ></div>
  </div>
</section>

<!-- Subscription Modal for Blueprint Download (Hidden Initially) -->
<div id="blueprint-subscription-modal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <button class="modal-close" id="blueprint-modal-close" aria-label="Close modal">&times;</button>
    <h3 id="blueprint-modal-title">Subscribe to Download</h3>
    <p id="blueprint-modal-desc">Enter your details to download your blueprint</p>
    <form id="blueprint-subscription-form">
      <div class="form-group">
        <input 
          type="text" 
          id="blueprint-sub-name" 
          name="name" 
          placeholder="Name" 
          required 
          maxlength="100"
        />
      </div>
      <div class="form-group">
        <input 
          type="email" 
          id="blueprint-sub-email" 
          name="email" 
          placeholder="Email" 
          required 
          maxlength="254"
        />
      </div>
      <button type="submit" class="btn-submit">Download Blueprint</button>
    </form>
  </div>
</div>

<!-- Quote Request Form (Hidden Initially) -->
<div id="quote-form" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <button class="modal-close" id="quote-close" aria-label="Close modal">&times;</button>
    <h3>Request a Quote</h3>
    <p>We'll send you a detailed quote within 24 hours</p>
    <form id="quote-request-form">
      <div class="form-group">
        <input 
          type="text" 
          id="quote-name" 
          name="name" 
          placeholder="Name" 
          required 
          maxlength="100"
        />
      </div>
      <div class="form-group">
        <input 
          type="email" 
          id="quote-email" 
          name="email" 
          placeholder="Email" 
          required 
          maxlength="254"
        />
      </div>
      <div class="form-group">
        <input 
          type="tel" 
          id="quote-phone" 
          name="phone" 
          placeholder="Phone (optional)" 
          maxlength="20"
        />
      </div>
      <div class="form-group">
        <textarea 
          id="quote-notes" 
          name="notes" 
          placeholder="Additional notes" 
          rows="4"
          maxlength="1000"
        ></textarea>
      </div>
      <button type="submit" class="btn-submit">Request Quote</button>
    </form>
  </div>
</div>

<!-- Blog Subscription Popup (Hidden Initially) -->
<div id="blog-popup" class="popup-overlay" style="display: none;">
  <div class="popup-content">
    <h3>Would you like to subscribe to my Blog?</h3>
    <div class="popup-buttons">
      <button id="blog-yes" class="popup-btn popup-btn-primary">Yes</button>
      <button id="blog-no" class="popup-btn popup-btn-secondary">No</button>
    </div>
  </div>
</div>

<!-- Success Message Popup (Hidden Initially) -->
<div id="success-popup" class="popup-overlay" style="display: none;">
  <div class="popup-content">
    <h3 id="success-popup-message">Success!</h3>
    <div class="popup-buttons">
      <button id="success-ok" class="popup-btn popup-btn-primary">OK</button>
    </div>
  </div>
</div>

<script>
/**
 * AI Workflow Wizard - Complete JavaScript
 */
document.addEventListener("DOMContentLoaded", function () {
    console.log('Wizard JavaScript loaded');
    const form = document.getElementById("ai-wizard-form");
    if (!form) {
        console.error('Form not found!');
        return;
    }

    const totalSteps = 5;
    let currentStep = 1;

    // DOM elements
    const formWrap = document.getElementById("ai-wizard-form-wrap");
    const completionScreen = document.getElementById("completion-screen");
    const progressContainer = document.getElementById("assistant-progress");
    const statusEl = document.getElementById("ai-wizard-status");
    const stepLabel = document.getElementById("ai-step-label");
    const stepCaption = document.getElementById("ai-step-caption");
    const progressFill = document.getElementById("ai-progress-fill");
    const prevBtn = document.getElementById("ai-prev-btn");
    const nextBtn = document.getElementById("ai-next-btn");
    const submitBtn = document.getElementById("ai-submit-btn");
    
    // Form inputs
    const goalInput = document.getElementById("goal");
    const workflowInput = document.getElementById("workflow");
    const painInput = document.getElementById("pain_points");
    const emailInput = document.getElementById("email");

    // Review elements
    const reviewGoal = document.getElementById("review-goal");
    const reviewWorkflow = document.getElementById("review-workflow");
    const reviewTools = document.getElementById("review-tools");
    const reviewPain = document.getElementById("review-pain");

    const stepCaptions = {
        1: "Your goal",
        2: "Current workflow",
        3: "Tools you use",
        4: "Pain points",
        5: "Review & email"
    };

    // Helper to get selected tools
    function getSelectedTools() {
        const checkboxes = document.querySelectorAll('input[name="tools"]:checked');
        const selected = Array.from(checkboxes).map(cb => cb.value);
        return selected.length > 0 ? selected.join(', ') : 'None selected';
    }

    function updateReview() {
        if (reviewGoal) reviewGoal.textContent = goalInput.value.trim() || "Not yet.";
        if (reviewWorkflow) reviewWorkflow.textContent = workflowInput.value.trim() || "Not set yet.";
        if (reviewTools) reviewTools.textContent = getSelectedTools();
        if (reviewPain) reviewPain.textContent = painInput.value.trim() || "Not set yet.";
    }

    function setStep(step) {
        currentStep = step;
        const steps = document.querySelectorAll(".mgrnz-ai-step");
        steps.forEach(function (el) {
            const s = parseInt(el.getAttribute("data-step"), 10);
            el.classList.toggle("active", s === currentStep);
        });

        if (stepLabel) stepLabel.textContent = "Step " + currentStep + " of " + totalSteps;
        if (stepCaption) stepCaption.textContent = stepCaptions[currentStep] || "";
        if (progressFill) progressFill.style.width = ((currentStep / totalSteps) * 100) + "%";
        if (prevBtn) prevBtn.style.visibility = currentStep === 1 ? "hidden" : "visible";
        if (nextBtn && submitBtn) {
            nextBtn.style.display = currentStep === totalSteps ? "none" : "inline-flex";
            submitBtn.style.display = currentStep === totalSteps ? "inline-flex" : "none";
        }
        updateReview();
    }

    function validateCurrentStep() {
        if (!statusEl) return true;
        
        statusEl.textContent = "";
        statusEl.classList.remove("mgrnz-status-error");
        statusEl.style.display = "none";

        if (currentStep === 1 && !goalInput.value.trim()) {
            statusEl.textContent = "Give me at least a sentence about your goal.";
            statusEl.classList.add("mgrnz-status-error");
            statusEl.style.display = "block";
            return false;
        }
        if (currentStep === 2 && !workflowInput.value.trim()) {
            statusEl.textContent = "Describe your current workflow so I have something to improve.";
            statusEl.classList.add("mgrnz-status-error");
            statusEl.style.display = "block";
            return false;
        }
        if (currentStep === 5 && emailInput.value) {
            const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value.trim());
            if (!isValid) {
                statusEl.textContent = "That email address doesn't look quite right.";
                statusEl.classList.add("mgrnz-status-error");
                statusEl.style.display = "block";
                return false;
            }
        }
        return true;
    }

    function showProgress(messages) {
        if (!progressContainer) return;
        formWrap.style.display = "none";
        progressContainer.style.display = "block";
        messages.forEach((msg, index) => {
            const msgEl = document.getElementById('progress-msg-' + (index + 1));
            if (msgEl) {
                msgEl.textContent = msg;
                setTimeout(() => msgEl.classList.add('active'), index * 1000);
            }
        });
    }

    function hideProgress() {
        if (progressContainer) progressContainer.style.display = "none";
    }

    function showCompletionScreen() {
        console.log('Showing completion screen with blueprint...');
        hideProgress();
        
        if (!completionScreen) {
            console.error('Completion screen element not found!');
            return;
        }

        // Clear any previous blueprint
        const existingBlueprint = completionScreen.querySelector('.blueprint-preview');
        if (existingBlueprint) existingBlueprint.remove();

        // Display the blueprint content if available
        if (window.wizardSessionData && window.wizardSessionData.blueprint) {
            const blueprintContainer = document.createElement('div');
            blueprintContainer.className = 'blueprint-preview';
            blueprintContainer.style.cssText = `
                background: #131c32;
                border: 1px solid rgba(255, 255, 255, 0.12);
                border-radius: 12px;
                padding: 1.5rem;
                margin-bottom: 2rem;
                max-height: 400px;
                overflow-y: auto;
                text-align: left;
            `;
            
            const blueprintTitle = document.createElement('h3');
            blueprintTitle.textContent = 'Your AI Workflow Blueprint';
            blueprintTitle.style.cssText = 'margin-top: 0; color: #ffcf00; font-size: 1.3rem;';
            
            const blueprintContent = document.createElement('div');
            blueprintContent.innerHTML = window.wizardSessionData.blueprint;
            blueprintContent.style.cssText = 'color: rgba(255, 255, 255, 0.9); line-height: 1.6;';
            
            blueprintContainer.appendChild(blueprintTitle);
            blueprintContainer.appendChild(blueprintContent);
            
            // Insert blueprint before the heading
            const completionMessage = completionScreen.querySelector('.completion-message');
            if (completionMessage) {
                completionMessage.parentNode.insertBefore(blueprintContainer, completionMessage);
            }
        }
        
        completionScreen.style.display = "block";
        completionScreen.classList.add('show');
        console.log('Completion screen visible!');
    }

    function showSuccessPopup(message) {
        const popup = document.getElementById('success-popup');
        const messageEl = document.getElementById('success-popup-message');
        const okBtn = document.getElementById('success-ok');
        
        if (popup && messageEl) {
            messageEl.textContent = message;
            popup.style.display = 'flex';
            popup.classList.add('show');
            
            if (okBtn) {
                okBtn.onclick = () => {
                    popup.style.display = 'none';
                    popup.classList.remove('show');
                };
            }
        }
    }

    // Event listeners
    if (prevBtn) {
        prevBtn.addEventListener("click", (e) => {
            e.preventDefault();
            if (currentStep > 1) setStep(currentStep - 1);
        });
    }

    if (nextBtn) {
        nextBtn.addEventListener("click", (e) => {
            e.preventDefault();
            if (!validateCurrentStep()) return;
            if (currentStep < totalSteps) setStep(currentStep + 1);
        });
    }

    if (submitBtn) {
        submitBtn.addEventListener("click", (e) => {
            e.preventDefault();
            if (!validateCurrentStep()) return;

            submitBtn.disabled = true;
            if (nextBtn) nextBtn.disabled = true;
            if (prevBtn) prevBtn.disabled = true;

            const payload = {
                goal: goalInput.value.trim(),
                workflow: workflowInput.value.trim(),
                tools: getSelectedTools(),
                pain_points: painInput.value.trim(),
                email: emailInput.value.trim() || null
            };

            localStorage.setItem('mgrnz_wizard_data', JSON.stringify(payload));

            showProgress([
                'ü§ñ Creating your AI workflow assistant...',
                'üîç Analyzing your workflow...',
                'üìù Generating your personalized blueprint...'
            ]);

            const nonce = (typeof wpApiSettings !== 'undefined' && wpApiSettings.nonce) 
                || (typeof wp !== 'undefined' && wp.apiFetch && wp.apiFetch.nonceMiddleware && wp.apiFetch.nonceMiddleware.nonce)
                || '';
            
            fetch('/wp-json/mgrnz/v1/ai-workflow', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'X-WP-Nonce': nonce },
                body: JSON.stringify(payload)
            })
            .then(response => response.text().then(text => {
                if (!response.ok) throw new Error('HTTP error ' + response.status);
                try {
                    return JSON.parse(text);
                } catch (e) {
                    console.error('JSON parse error:', e);
                    throw new Error('Invalid JSON response');
                }
            }))
            .then(data => {
                if (data.success && data.blueprint) {
                    window.wizardSessionData = {
                        sessionId: data.session_id || 'unknown',
                        blueprint: data.blueprint,
                        wizardData: payload
                    };
                    setTimeout(() => showCompletionScreen(), 3000);
                } else {
                    throw new Error('Invalid response from server');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                hideProgress();
                formWrap.style.display = "block";
                if (statusEl) {
                    statusEl.textContent = error.message || 'Unable to generate blueprint. Please try again.';
                    statusEl.classList.add("mgrnz-status-error");
                    statusEl.style.display = "block";
                }
                submitBtn.disabled = false;
                if (nextBtn) nextBtn.disabled = false;
                if (prevBtn) prevBtn.disabled = false;
            });
        });
    }

    // Completion screen buttons
    const editBtn = document.getElementById('btn-edit-workflow');
    if (editBtn) {
        editBtn.addEventListener('click', () => {
            const storedData = localStorage.getItem('mgrnz_wizard_data');
            if (storedData) {
                const data = JSON.parse(storedData);
                if (goalInput) goalInput.value = data.goal || '';
                if (workflowInput) workflowInput.value = data.workflow || '';
                if (painInput) painInput.value = data.pain_points || '';
                if (emailInput) emailInput.value = data.email || '';
                
                if (data.tools) {
                    const selectedTools = data.tools.split(', ');
                    document.querySelectorAll('input[name="tools"]').forEach(checkbox => {
                        checkbox.checked = selectedTools.includes(checkbox.value);
                    });
                }
            }
            
            completionScreen.style.display = 'none';
            formWrap.style.display = 'block';
            setStep(1);
            
            if (submitBtn) submitBtn.disabled = false;
            if (nextBtn) nextBtn.disabled = false;
            if (prevBtn) prevBtn.disabled = false;
        });
    }

    const downloadBtn = document.getElementById('btn-download-blueprint');
    if (downloadBtn) {
        downloadBtn.addEventListener('click', () => {
            try {
                if (window.ml) {
                    window.ml('show', 'nRV0LZ', true);
                } else {
                    showSuccessPopup('Subscribe form unavailable. Please refresh the page.');
                }
            } catch (err) {
                console.error('MailerLite error:', err);
                showSuccessPopup('Subscribe form unavailable. Please refresh the page.');
            }
        });
    }

    const quoteBtn = document.getElementById('btn-get-quote');
    if (quoteBtn) {
        quoteBtn.addEventListener('click', () => {
            console.log('Quote button clicked - attempting MailerLite');
            try {
                if (window.ml) {
                    window.ml('show', 'E0CY8N', true);
                } else {
                    console.warn('MailerLite not available, showing fallback');
                    const modal = document.getElementById('quote-form');
                    if (modal) {
                        modal.style.display = 'flex';
                        modal.classList.add('show');
                    }
                }
            } catch (err) {
                console.error('MailerLite error:', err);
                const modal = document.getElementById('quote-form');
                if (modal) {
                    modal.style.display = 'flex';
                    modal.classList.add('show');
                }
            }
        });
    }

    const goBackBtn = document.getElementById('btn-go-back');
    if (goBackBtn) {
        goBackBtn.addEventListener('click', () => {
            const popup = document.getElementById('blog-popup');
            if (popup) {
                popup.style.display = 'flex';
                popup.classList.add('show');
            }
        });
    }

    // Modal close handlers
    const blueprintModalClose = document.getElementById('blueprint-modal-close');
    if (blueprintModalClose) {
        blueprintModalClose.addEventListener('click', () => {
            const modal = document.getElementById('blueprint-subscription-modal');
            if (modal) {
                modal.style.display = 'none';
                modal.classList.remove('show');
            }
        });
    }

    const quoteClose = document.getElementById('quote-close');
    if (quoteClose) {
        quoteClose.addEventListener('click', () => {
            const modal = document.getElementById('quote-form');
            if (modal) {
                modal.style.display = 'none';
                modal.classList.remove('show');
            }
        });
    }

    // Blog popup
    const blogYes = document.getElementById('blog-yes');
    const blogNo = document.getElementById('blog-no');
    const blogPopup = document.getElementById('blog-popup');

    if (blogYes && blogPopup) {
        blogYes.addEventListener('click', () => {
            try {
                if (window.ml) window.ml("show", "qyrDmy", true);
            } catch (err) {
                console.warn("MailerLite not available:", err);
            }
            blogPopup.style.display = 'none';
        });
    }

    if (blogNo && blogPopup) {
        blogNo.addEventListener('click', () => {
            showSuccessPopup('Thanks for trying the AI wizard!');
            blogPopup.style.display = 'none';
        });
    }

    // Form submissions
    const blueprintForm = document.getElementById('blueprint-subscription-form');
    if (blueprintForm) {
        blueprintForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const modal = document.getElementById('blueprint-subscription-modal');
            if (modal) modal.style.display = 'none';
            showSuccessPopup('Blueprint download feature coming soon!');
        });
    }

    const quoteForm = document.getElementById('quote-request-form');
    if (quoteForm) {
        quoteForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const modal = document.getElementById('quote-form');
            if (modal) modal.style.display = 'none';
            showSuccessPopup('Quote request submitted! We\'ll contact you soon.');
        });
    }

    // Debug Mode
    function checkDebugMode() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('debug') === 'true') {
            const debugBtn = document.createElement('button');
            debugBtn.textContent = 'ü§ñ Fill Test Data';
            debugBtn.className = 'mgrnz-btn mgrnz-btn-secondary';
            debugBtn.style.cssText = 'margin-top: 1rem; font-size: 0.85rem; padding: 0.65rem 1.2rem; background-color: #ff00ff; border-color: #ff00ff; color: white;';
            
            debugBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (goalInput) goalInput.value = "I want to automate my daily reporting process to save 2 hours a day.";
                if (workflowInput) workflowInput.value = "Currently I log into 3 different portals, download CSVs, merge them in Excel, and email a PDF summary to my boss.";
                
                const exampleTools = ['Gmail', 'Google Sheets', 'Make.com', 'OpenAI (ChatGPT)'];
                document.querySelectorAll('input[name="tools"]').forEach(checkbox => {
                    checkbox.checked = exampleTools.includes(checkbox.value);
                });
                
                if (painInput) painInput.value = "It's boring, prone to copy-paste errors, and takes time away from real work.";
                if (emailInput) emailInput.value = "test@example.com";
                
                debugBtn.textContent = '‚úÖ Data Filled!';
                setTimeout(() => debugBtn.textContent = 'ü§ñ Fill Test Data', 2000);
            });
            
            if (formWrap) formWrap.insertBefore(debugBtn, formWrap.firstChild);
        }
    }

    // Initialize
    checkDebugMode();
    setStep(1);
});
</script>
